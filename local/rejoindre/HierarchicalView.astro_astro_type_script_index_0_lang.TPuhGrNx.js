document.addEventListener("DOMContentLoaded",function(){const A=document.getElementById("toggle-all-regions");A&&A.addEventListener("click",function(){const e=document.querySelectorAll(".region-section"),r=Array.from(e).some(n=>n.querySelector(".region-header")?.getAttribute("aria-expanded")!=="true");e.forEach(n=>{const o=n.querySelector(".region-header"),t=n.querySelector(".region-content");if(o&&t){o.setAttribute("aria-expanded",r?"true":"false"),t.classList.toggle("max-h-0",!r),t.setAttribute("aria-hidden",r?"false":"true");const s=o.querySelector(".region-caret");s&&s.classList.toggle("rotate-180",r)}}),c(),f()}),document.addEventListener("click",function(e){const r=e.target.closest(".region-header");r&&b(r);const n=e.target.closest(".department-header");n&&h(n);const o=e.target.closest(".toggle-departments-btn");if(o){const t=o.closest(".region-section");t&&(m(t),p(t))}});function b(e){const n=e.closest(".region-section").querySelector(".region-content"),o=e.querySelector(".region-caret"),t=e.getAttribute("aria-expanded")==="true";e.setAttribute("aria-expanded",!t),n.setAttribute("aria-hidden",t),t?(n.classList.add("max-h-0"),o?.classList.remove("rotate-180")):(n.classList.remove("max-h-0"),o?.classList.add("rotate-180")),c(),f()}function h(e){const n=e.closest(".department-group").querySelector(".department-content"),o=e.getAttribute("aria-expanded")==="true";e.setAttribute("aria-expanded",(!o).toString()),n&&(o?(n.classList.add("hidden"),n.setAttribute("aria-hidden","true")):(n.classList.remove("hidden"),n.setAttribute("aria-hidden","false"))),c();const t=e.closest(".region-section");t&&p(t)}function c(){Array.from(document.querySelectorAll(".region-section")).forEach(r=>{const n=r.querySelector(".region-header");if(!n)return;const o=r.classList.contains("hidden"),t=r.closest(".region-content"),s=!!(t&&(t.getAttribute("aria-hidden")==="true"||t.classList.contains("max-h-0")));if(o||s){n.setAttribute("tabindex","-1"),r.querySelectorAll(".department-header, .group-tile a, .regional-link, .toggle-departments-btn").forEach(g=>g.setAttribute("tabindex","-1"));return}n.setAttribute("tabindex","0");const a=n.getAttribute("aria-expanded")==="true",l=r.querySelectorAll(".department-header"),u=r.querySelector(".toggle-departments-btn");if(!a){l.forEach(d=>d.setAttribute("tabindex","-1")),r.querySelectorAll(".group-tile a").forEach(d=>d.setAttribute("tabindex","-1")),r.querySelectorAll(".regional-link").forEach(d=>d.setAttribute("tabindex","-1")),u&&u.setAttribute("tabindex","-1");return}l.forEach(i=>i.setAttribute("tabindex","0")),u&&u.setAttribute("tabindex","0"),r.querySelectorAll(".regional-link").forEach(i=>i.setAttribute("tabindex","0")),r.querySelectorAll(".department-group").forEach(i=>{const g=i.querySelector(".department-header"),d=i.querySelectorAll(".department-content a"),y=g?.getAttribute("aria-expanded")==="true";d.forEach(x=>x.setAttribute("tabindex",y?"0":"-1"))})})}function p(e){const r=e.querySelector(".toggle-departments-btn");if(!r)return;const n=Array.from(e.querySelectorAll(".department-header")),o=n.length>0&&n.every(t=>t.getAttribute("aria-expanded")==="true");r.textContent=o?"Tout réduire":"Tout développer",r.setAttribute("aria-label",o?"Réduire tous les départements de la région":"Développer tous les départements de la région"),r.setAttribute("aria-pressed",o?"true":"false")}function f(){const e=document.getElementById("toggle-all-regions");if(!e)return;const r=Array.from(document.querySelectorAll(".region-section .region-header")),n=r.length>0&&r.every(o=>o.getAttribute("aria-expanded")==="true");e.textContent=n?"Tout réduire":"Tout développer",e.setAttribute("aria-label",n?"Réduire toutes les régions":"Développer toutes les régions"),e.setAttribute("aria-pressed",n?"true":"false")}function m(e){const r=Array.from(e.querySelectorAll(".department-header")),n=Array.from(e.querySelectorAll(".department-content"));if(!r.length)return;const o=r.some(t=>t.getAttribute("aria-expanded")!=="true");r.forEach((t,s)=>{t.setAttribute("aria-expanded",o?"true":"false");const a=n[s]||t.closest(".department-group")?.querySelector(".department-content");a&&(o?(a.classList.remove("hidden"),a.setAttribute("aria-hidden","false")):(a.classList.add("hidden"),a.setAttribute("aria-hidden","true")))}),c()}document.addEventListener("keydown",function(e){if(e.key==="Enter"||e.key===" "){const r=e.target?.closest(".region-header"),n=e.target?.closest(".department-header");r?(e.preventDefault(),b(r)):n&&(e.preventDefault(),h(n))}if(e.key==="ArrowDown"||e.key==="ArrowUp"){const r=e.target?.closest(".region-header"),n=e.target?.closest(".department-header"),o=e.target?.closest(".group-tile a");if(r){e.preventDefault();const t=Array.from(document.querySelectorAll('.region-header[tabindex="0"]')),s=t.indexOf(r);let a;e.key==="ArrowDown"?a=(s+1)%t.length:a=(s-1+t.length)%t.length,t[a]&&t[a].focus()}else if(n||o){e.preventDefault();const t=Array.from(document.querySelectorAll('.region-header[tabindex="0"], .department-header[tabindex="0"], .group-tile a[tabindex="0"], .regional-link[tabindex="0"]')),s=n||o,a=t.indexOf(s);let l;e.key==="ArrowDown"?l=(a+1)%t.length:l=(a-1+t.length)%t.length,t[l]&&t[l].focus()}}(e.ctrlKey||e.metaKey)&&(e.key==="o"||e.key==="O"||e.key==="c"||e.key==="C")&&(e.preventDefault(),document.getElementById("toggle-all-regions")?.click())}),c(),f(),document.querySelectorAll(".region-section").forEach(e=>p(e))});
